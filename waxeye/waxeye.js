!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.waxeye=t():e.waxeye=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e,t){return new o(e,t)}function s(){return i.instance}r.r(t),r.d(t,"WaxeyeParser",(function(){return c})),r.d(t,"AST",(function(){return u})),r.d(t,"EmptyAST",(function(){return p})),r.d(t,"ErrChar",(function(){return f})),r.d(t,"ErrCC",(function(){return l})),r.d(t,"ErrAny",(function(){return h})),r.d(t,"ParseError",(function(){return d}));class o{constructor(e,t){this.head=e,this.tail=t}isEmpty(){return!1}toArray(){const e=[this.head];let t=this.tail;for(;!t.isEmpty();)e.push(t.head),t=t.tail;return e}[Symbol.iterator](){let e=this;return{next(){if(e.isEmpty())return{done:!0};const t=e.head;return e=e.tail,{value:t}}}}}class i{constructor(){}isEmpty(){return!0}toArray(){return[]}[Symbol.iterator](){return{next:()=>({done:!0})}}}function a(e){switch(e.type){case 1:case 11:case 12:case 10:return e;case 4:case 5:case 6:case 7:case 8:case 9:return{type:e.type,expr:a(e.expr)};case 2:case 3:return{type:e.type,exprs:e.exprs.reduceRight((e,t)=>n(a(t),e),s())}}}i.instance=new i;class c{constructor(e,t){this.config=e,this.start=t,this.env=function(e){const t={};for(const[r,n]of Object.entries(e))t[r]={mode:n.mode,exp:a(n.exp)};return t}(e)}parse(e,t=this.start){if(!this.env[t])throw new Error(`Invalid non-terminal ${t}. Expected one of: ${Object.keys(this.env).join(", ")}`);return function(e,t,r){let o=P(e,r,S(e[t].exp,0,s(),new y(0,n(t,s()),s(),t),s()));for(;;)switch(o.type){case 1:o=P(e,r,o);break;case 2:const{continuations:n,value:s}=o;if(n.isEmpty())return j(e,t,r,s);o=$(r,s,n.head,n.tail)}}(this.env,t,e)}}class u{constructor(e,t,r,n){this.type=e,this.children=t,this.start=r,this.end=n}isEmpty(){return""===this.type&&0===this.children.length}}function p(e,t){return new u("",[],e,t)}class f{constructor(e){this.char=e}toGrammarString(){return`'${JSON.stringify(this.char).slice(1,-1)}'`}}class l{constructor(e){this.charClasses=e}toGrammarString(){return`[${this.charClasses.map(e=>JSON.stringify("number"==typeof e?String.fromCodePoint(e):`${String.fromCodePoint(e[0])}-${String.fromCodePoint(e[1])}`).slice(1,-1)).join("")}]`}}class h{toGrammarString(){return"."}}class d{constructor(e,t,r,n,s){this.pos=e,this.line=t,this.col=r,this.nt=n,this.chars=s}toString(){const e=this.chars.map(e=>e.toGrammarString()).join(" | ")||"''";return`Parse error: Failed to match '${this.nt.join(",")}' at line=${this.line}, col=${this.col}, pos=${this.pos}. Expected: ${e}`}}class y{constructor(e,t,r,n){this.pos=e,this.nonterminals=t,this.failedChars=r,this.currentNT=n}toParseError(e){const[t,r]=function(e,t){let r=1,n=0,s=-1;for(;-1!==(s=t.indexOf("\n",n))&&s<e;)++r,n=s+1;return[r,e-n+1]}(this.pos,e),n=[],s=new Set;for(const e of this.nonterminals)s.has(e)||(n.push(e),s.add(e));return new d(this.pos,t,r,n,this.failedChars.toArray().reverse())}}function m(e,t,r){return null!==e?t>e.pos?new y(t,n(e.currentNT,s()),n(r,s()),e.currentNT):t===e.pos?new y(e.pos,n(e.currentNT,e.nonterminals),n(r,e.failedChars),e.currentNT):new y(e.pos,e.nonterminals,e.failedChars,e.currentNT):new y(0,n("",s()),n(r,s()),"")}function w(e){return{type:1,expressions:e}}function x(e,t,r){return{type:2,expressions:e,pos:t,asts:r}}function E(e,t,r){return{type:6,expression:e,pos:t,asts:r}}function g(e,t,r){return{type:1,pos:e,asts:t,err:r}}function v(e){return{type:2,err:e}}function S(e,t,r,n,s){return{type:1,asts:r,continuations:s,err:n,exp:e,pos:t}}function b(e,t){return{type:2,continuations:e,value:t}}function P(e,t,r){const{exp:o,pos:i,asts:a,err:c,continuations:u}=r,p=i>=t.length;switch(o.type){case 10:return b(u,p?v(m(c,i,new h)):C(O(t,i))?g(i+1,n(t[i],a),c):g(i+2,n(t[i]+t[i+1],a),c));case 2:{const{exprs:e}=o;return e.isEmpty()?b(u,v(c)):S(e.head,i,a,c,n(x(e.tail,i,a),u))}case 7:return S(o.expr,i,s(),c,n(function(e,t,r){return{type:3,pos:e,asts:t,err:r}}(i,a,c),u));case 8:return S(o.expr,i,s(),c,n(function(e,t,r){return{type:4,pos:e,asts:t,err:r}}(i,a,c),u));case 9:return S(o.expr,i,s(),c,n(function(e){return{type:8,asts:e}}(a),u));case 11:const d=o.char;return b(u,1===d.length?p||d!==t[i]?v(m(c,i,new f(d))):g(i+1,n(t[i],a),c):i+1>=t.length||d[0]!==t[i]||d[1]!==t[i+1]?v(m(c,i,new f(d))):g(i+2,n(t[i]+t[i+1],a),c));case 12:const P=o.codepoints;if(p)return b(u,v(m(c,i,new l(P))));const $=O(t,i);for(const e of P){if("number"==typeof e?e===$:e[0]<=$&&e[1]>=$)return b(u,C($)?g(i+1,n(t[i],a),c):g(i+2,n(t[i]+t[i+1],a),c))}return b(u,v(m(c,i,new l(P))));case 3:{const{exprs:e}=o;return e.isEmpty()?b(u,g(i,a,c)):S(e.head,i,a,c,n(w(e.tail),u))}case 4:return S(o.expr,i,a,c,n({type:7,expression:o.expr},u));case 5:return S(o.expr,i,a,c,n(E(o.expr,i,a),u));case 6:return S(o.expr,i,a,c,n(function(e,t){return{type:5,pos:e,asts:t}}(i,a),u));case 1:const{name:j}=o,N=e[j];return S(N.exp,i,s(),new y(c.pos,c.nonterminals,c.failedChars,j),n(function(e,t,r,n,s){return{type:9,mode:e,name:t,asts:r,nt:n,startPos:s}}(N.mode,j,a,c.currentNT,i),u));default:throw new Error(`Unsupported exp.type in exp=${o.type} action=${JSON.stringify(r)}`)}}function $(e,t,r,s){switch(t.type){case 1:return function(e,t,r,s){switch(r.type){case 1:{const{expressions:e}=r;return e.isEmpty()?b(s,t):S(e.head,t.pos,t.asts,t.err,n(w(e.tail),s))}case 6:case 7:return S(r.expression,t.pos,t.asts,t.err,n(E(r.expression,t.pos,t.asts),s));case 2:case 5:return b(s,t);case 3:return b(s,g(r.pos,r.asts,r.err));case 8:return b(s,g(t.pos,r.asts,t.err));case 4:return b(s,v(r.err));case 9:const{mode:e,name:o,asts:i,nt:a}=r,c=t.asts,p=new y(t.err.pos,t.err.nonterminals,t.err.failedChars,a);switch(e){case 1:return b(s,g(t.pos,n(new u(o,c.toArray().reverse(),r.startPos,t.pos),i),p));case 2:return c.isEmpty()?b(s,g(t.pos,i,p)):c.tail.isEmpty()?b(s,g(t.pos,n(c.head,i),p)):b(s,g(t.pos,n(new u(o,c.toArray().reverse(),r.startPos,t.pos),i),p));case 3:return b(s,g(t.pos,i,p));default:throw N(e,"Invalid mode")}}}(0,t,r,s);case 2:return function(e,t,r,s){switch(r.type){case 2:{const{expressions:e}=r;return e.isEmpty()?b(s,t):S(e.head,r.pos,r.asts,t.err,n(x(e.tail,r.pos,r.asts),s))}case 1:case 8:case 7:return b(s,t);case 3:return b(s,v(r.err));case 4:case 6:case 5:return b(s,g(r.pos,r.asts,t.err));case 9:const e=t.err;return b(s,v(new y(e.pos,e.nonterminals,e.failedChars,r.nt)));default:throw N(r,"Invalid continuation")}}(0,t,r,s)}}function j(e,t,r,n){switch(n.type){case 1:const o=n.asts;if(!(n.pos>=r.length))return n.err&&n.pos===n.err.pos?new y(n.pos,n.err.nonterminals,n.err.failedChars,"").toParseError(r):new y(n.pos,s(),s(),"").toParseError(r);{const r=e[t].mode;switch(r){case 1:return new u(t,o.toArray().reverse(),0,n.pos);case 2:if(o.isEmpty())return p(0,n.pos);if(o.tail.isEmpty()){const e=o.head;if("string"==typeof e)throw new Error(`Expected an AST, got a string ${JSON.stringify(e)}, in ${n}`);return e}return new u(t,o.toArray().reverse(),0,n.pos);case 3:return p(0,n.pos);default:throw N(r,"Invalid mode")}}case 2:return n.err.toParseError(r);default:throw N(n,"Invalid MatchResultType")}}function C(e){return e<=65535}function O(e,t){const r=e.codePointAt(t);if(void 0===r)throw new Error(`Undefined input codepoint at ${t} in ${JSON.stringify(e)}`);return r}function N(e,t){throw new Error(`${t}: ${JSON.stringify(e)}`)}}])}));
//# sourceMappingURL=waxeye.js.map